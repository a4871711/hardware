<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.lab1024.sa.admin.module.system.menu.dao.MenuDao">

    <delete id="deleteByMenuIdList">
        <if test="menuIdList != null and menuIdList.size > 0">
            <foreach collection="menuIdList" item="item" separator=";">
                update t_menu AS m
                set m.deleted_flag = #{deletedFlag},
                m.update_user_id = #{updateUserId}
                where m.menu_id = #{item}
            </foreach>
        </if>
    </delete>

    <select id="getByMenuName"
            resultType="net.lab1024.sa.admin.module.system.menu.domain.entity.MenuBaseEntity">
        select *
        from t_menu AS m
        where m.menu_name = #{menuName}
          and m.parent_id = #{parentId}
          and m.deleted_flag = #{deletedFlag}
        limit 1
    </select>

    <select id="queryMenuList"
            resultType="net.lab1024.sa.admin.module.system.menu.domain.vo.SubscriptionPlanMenuVOTemp">
        select *
        from t_menu AS m
        where m.deleted_flag = #{deletedFlag}
        <if test="disabledFlag != null">
            and m.disabled_flag = #{disabledFlag}
        </if>
        <if test="menuTypeList != null and menuTypeList.size > 0">
            and m.menu_type in
            <foreach collection="menuTypeList" open="(" close=")" item="item" separator=",">
                #{item}
            </foreach>
        </if>
        order by m.parent_id desc, m.sort asc
    </select>

    <select id="getPointListByMenuId"
            resultType="net.lab1024.sa.admin.module.system.menu.domain.entity.MenuBaseEntity">
        select *
        from t_menu AS m
        where m.parent_id = #{menuId}
          and m.deleted_flag = #{deletedFlag}
          and m.menu_type = #{menuType}
    </select>

    <select id="queryMenuByEmployeeId"
            resultType="net.lab1024.sa.admin.module.system.menu.domain.vo.SubscriptionPlanMenuVOTemp">
        select m.*
        from t_menu AS m
        left join t_role_menu AS rm on rm.menu_id = m.menu_id
        left join t_role_employee AS re on re.role_id = rm.role_id
        where m.disabled_flag = #{disabledFlag}
        and m.deleted_flag = #{deletedFlag}
        <if test="employeeId != null">
            and re.employee_id = #{employeeId}
        </if>
    </select>

    <select id="queryMenuByType" resultType="net.lab1024.sa.admin.module.system.menu.domain.entity.MenuBaseEntity">
        select *
        from t_menu AS m
        where m.disabled_flag = #{disabledFlag}
          and m.deleted_flag = #{deletedFlag}
          and m.menu_type = #{menuType}
    </select>

    <select id="getByWebPerms" resultType="net.lab1024.sa.admin.module.system.menu.domain.entity.MenuBaseEntity">
        select *
        from t_menu AS m
        where m.web_perms = #{webPerms}
          and m.deleted_flag = #{deletedFlag}
        limit 1
    </select>

    <select id="selectMenuIdByParentIdList" resultType="java.lang.Long">
        <if test="menuIdList != null and menuIdList.size > 0">
            select m.menu_id
            from t_menu AS m
            where m.parent_id in
            <foreach collection="menuIdList" open="(" close=")" item="item" separator=",">
                #{item}
            </foreach>
        </if>
    </select>

</mapper>